<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Admin â€“ Kinder-Ferien-Club</title>
<link rel="stylesheet" href="/static/admin.css">
</head>
<body>

<h1>KFC â€“ Adminbereich</h1>

<div class="top-bar">
    <form method="get">
        <input type="hidden" name="pw" value="{{ pw }}">
        <input type="text" name="search" placeholder="Suchen nach ID / Name" value="{{ search_query }}">
        <button type="submit">Suchen</button>
    </form>

    <a class="export-btn" href="/export_excel?pw={{ pw }}">â¬‡ Excel Export</a>
</div>

<table>
<thead>
<tr>
    <th>ID</th>
    <th>G</th>
    <th>Vorname</th>
    <th>Nachname</th>
    <th>Geburtsdatum</th>
    <th>Alter</th>
    <th>Gruppe</th>
    <th>E-Mail</th>
    <th>Allergien</th>
    <th>Tage</th>
    <th>Verse</th>
    <th>Punkte</th>
    <th>Unterschrift</th>
    <th>Aktion</th>
</tr>
</thead>

<tbody>
{% for r in registrations %}
<tr>
<form method="post" action="/update/{{ r.ID }}?pw={{ pw }}">

<td>{{ r.ID }}</td>

<td>
<select name="Geschlecht">
    <option value="m" {% if r.Geschlecht=="m" %}selected{% endif %}>m</option>
    <option value="w" {% if r.Geschlecht=="w" %}selected{% endif %}>w</option>
</select>
</td>

<td><input name="Vorname" value="{{ r.Vorname }}"></td>
<td><input name="Nachname" value="{{ r.Nachname }}"></td>

<td>
<input type="date" name="Geburtsdatum" value="{{ r.Geburtsdatum }}">
</td>

<td>{{ r.Alter }}</td>
<td>{{ r.Gruppe }}</td>

<td>
{% if r.Email %}
<input name="Email" value="{{ r.Email }}">
{% else %}
<span class="muted">â€“</span>
{% endif %}
</td>

<td>
<input name="Allergien" value="{{ r.Allergien }}">
</td>

<td class="checkbox-line">
{% for i in range(1,6) %}
<label>
<input type="checkbox" name="Tag{{i}}" {% if r["Tag"+i|string] %}checked{% endif %}>
{{ i }}
</label>
{% endfor %}
</td>

<td class="checkbox-line">
{% for i in range(1,6) %}
<label>
<input type="checkbox" name="Verse{{i}}" {% if r["Verse"+i|string] %}checked{% endif %}>
{{ i }}
</label>
{% endfor %}
</td>

<td class="punkte">{{ r.Punkte }}</td>

<td>
{% if r.Unterschrift %}
<img src="{{ r.Unterschrift }}" class="signature-preview">
{% else %}
â€“
{% endif %}
</td>

<td class="actions">
<button type="submit" class="save">ğŸ’¾</button>
<a href="/delete/{{ r.ID }}?pw={{ pw }}"
   class="delete"
   onclick="return confirm('Kind wirklich lÃ¶schen?');">âŒ</a>
</td>

</form>
</tr>
{% endfor %}
</tbody>
</table>

<script>
function recalc(row) {
    let points = 0;
    row.querySelectorAll('input[type="checkbox"]').forEach(cb => {
        if (cb.checked) points++;
    });
    row.querySelector(".punkte").innerText = points;
}

document.querySelectorAll("tbody tr").forEach(row => {
    row.querySelectorAll("input[type='checkbox']").forEach(cb => {
        cb.addEventListener("change", () => recalc(row));
    });
});
</script>

</body>
</html>
