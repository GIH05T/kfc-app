<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kinder-Ferien-Club Steinen – Online-Anmeldung</title>
<link rel="stylesheet" href="/static/style.css">
</head>

<body>

<div class="container">
    <img src="/static/icon-kfc.png" class="logo" alt="Ferienclub Logo">

    <h1>Kinder-Ferien-Club Steinen</h1>
    <h2>Online-Anmeldung 2026</h2>

    <form id="registration-form" action="/" method="POST">

        <label>Vorname<span class="required">*</span></label>
        <input type="text" id="Vorname" name="Vorname" required>

        <label>Nachname<span class="required">*</span></label>
        <input type="text" id="Nachname" name="Nachname" required>

        <label>E-Mail (freiwillig)</label>
        <input type="email" id="email" name="email">

        <label>Straße<span class="required">*</span></label>
        <input type="text" id="strasse" name="strasse" required>

        <label>Postleitzahl<span class="required">*</span></label>
        <input type="text" id="plz" name="plz" required>

        <label>Ort<span class="required">*</span></label>
        <input type="text" id="ort" name="ort" required>

        <label>Geburtsdatum<span class="required">*</span></label>
        <input type="date" id="geburtsdatum" name="geburtsdatum" required>

        <label>Notfallnummer<span class="required">*</span></label>
        <input type="tel" id="notfallnummer" name="notfallnummer" required>

        <label>Allergien (freiwillig)</label>
        <select id="allergien" name="allergien">
            <option value="">-- Keine Angabe --</option>
            <option value="keine">Keine</option>
            <option value="nüsse">Nüsse</option>
            <option value="laktose">Laktose</option>
            <option value="ei">Ei</option>
            <option value="gluten">Gluten</option>
        </select>

        <label>Unterschrift<span class="required">*</span></label>
        <canvas id="signature-pad"></canvas>

        <button type="button" id="reset-btn" class="reset-btn">Signatur löschen</button>

        <div class="checkbox-container">
            <input type="checkbox" id="dsgvo" required>
            <label for="dsgvo">
                Ich stimme der <a href="/datenschutz" target="_blank">Datenschutzerklärung</a> zu
                <span class="required">*</span>
            </label>
        </div>

        <input type="hidden" id="signature" name="unterschrift">

        <button type="submit" id="submit-btn" disabled>Jetzt anmelden</button>

    </form>
</div>

<!-- ✅ SIGNATUR SCRIPT (MAUS + TOUCH + KORREKTE SKALIERUNG) -->
<script>
const canvas = document.getElementById("signature-pad");
const ctx = canvas.getContext("2d");
const hiddenInput = document.getElementById("signature");
const resetBtn = document.getElementById("reset-btn");

let drawing = false;

function resizeCanvas() {
    const ratio = window.devicePixelRatio || 1;
    canvas.width = canvas.offsetWidth * ratio;
    canvas.height = canvas.offsetHeight * ratio;
    ctx.scale(ratio, ratio);
}
resizeCanvas();

function getPos(e) {
    const rect = canvas.getBoundingClientRect();
    if (e.touches) {
        return {
            x: e.touches[0].clientX - rect.left,
            y: e.touches[0].clientY - rect.top
        };
    } else {
        return {
            x: e.clientX - rect.left,
            y: e.clientY - rect.top
        };
    }
}

function start(e) {
    drawing = true;
    const pos = getPos(e);
    ctx.beginPath();
    ctx.moveTo(pos.x, pos.y);
}

function move(e) {
    if (!drawing) return;
    const pos = getPos(e);
    ctx.lineTo(pos.x, pos.y);
    ctx.stroke();
}

function end() {
    drawing = false;
    hiddenInput.value = canvas.toDataURL();
    checkForm();
}

canvas.addEventListener("mousedown", start);
canvas.addEventListener("mousemove", move);
canvas.addEventListener("mouseup", end);
canvas.addEventListener("touchstart", start);
canvas.addEventListener("touchmove", move);
canvas.addEventListener("touchend", end);

resetBtn.addEventListener("click", () => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    hiddenInput.value = "";
    checkForm();
});
</script>

<!-- ✅ BUTTON GRAU → GRÜN BEI VOLLSTÄNDIGER ANMELDUNG -->
<script>
const submitBtn = document.getElementById("submit-btn");

function checkForm() {
    const requiredFields = document.querySelectorAll(
        "#Vorname, #Nachname, #strasse, #plz, #ort, #geburtsdatum, #notfallnummer"
    );

    let allFilled = true;
    requiredFields.forEach(field => {
        if (!field.value.trim()) allFilled = false;
    });

    const dsgvo = document.getElementById("dsgvo").checked;
    const signatureFilled = document.getElementById("signature").value.trim() !== "";

    if (allFilled && dsgvo && signatureFilled) {
        submitBtn.disabled = false;
        submitBtn.style.background = "#7ccc00";
    } else {
        submitBtn.disabled = true;
        submitBtn.style.background = "#aaa";
    }
}

document.addEventListener("input", checkForm);
document.getElementById("dsgvo").addEventListener("change", checkForm);
resetBtn.addEventListener("click", checkForm);
</script>

</body>
</html>
