<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kinder-Ferien-Club Steinen – Online-Anmeldung 2026</title>
<link rel="stylesheet" href="/static/style.css">
</head>
<body>
<div class="container">
    <img src="/static/icon-kfc.png" class="logo" alt="Ferienclub Logo">
    <h1>Kinder-Ferien-Club Steinen</h1>
    <h2>Online-Anmeldung 2026</h2>

    <form id="registration-form" action="/" method="POST">
	
		<label for="geschlecht">Geschlecht<span class="required">*</span></label>
		<select id="geschlecht" name="Geschlecht" required>
			<option value="">-- Bitte wählen --</option>
			<option value="m">männlich</option>
			<option value="w">weiblich</option>
		</select>
		
        <label for="Vorname">Vorname<span class="required">*</span></label>
        <input type="text" id="Vorname" name="Vorname" placeholder="Max" required>

        <label for="Nachname">Nachname<span class="required">*</span></label>
        <input type="text" id="Nachname" name="Nachname" placeholder="Mustermann" required>

        <label for="strasse">Straße<span class="required">*</span></label>
        <input type="text" id="strasse" name="Strasse" placeholder="Musterstraße 12" required>

        <label for="plz">Postleitzahl<span class="required">*</span></label>
        <input type="text" id="plz" name="PLZ" placeholder="79665" required>

        <label for="ort">Ort<span class="required">*</span></label>
        <input type="text" id="ort" name="Ort" placeholder="Steinen" required>

        <label for="geburtsdatum">Geburtsdatum<span class="required">*</span></label>
        <input type="date" id="geburtsdatum" name="Geburtsdatum" required>

        <label for="notfallnummer">Notfalltelefonnummer<span class="required">*</span></label>
        <input type="tel" id="notfallnummer" name="Notfallnummer" placeholder="z.B. 01234 567890" required>

        </select>

        <label>Unterschrift<span class="required">*</span></label>
        <canvas id="signature-pad"></canvas>
        <button type="button" class="reset-btn" id="reset-btn">Signatur löschen</button>
        <input type="hidden" id="signature" name="Unterschrift" required>

        <div class="checkbox-container">
            <input type="checkbox" id="dsgvo" name="DSGVO" required>
            <label for="dsgvo">Ich stimme der <a href="/datenschutz" target="_blank">Datenschutzerklärung</a> zu <span class="required">*</span></label>
        </div>

        <button type="submit" id="submit-btn" disabled>Jetzt anmelden</button>
    </form>
</div>

<script>
// --- Signatur Pad ---
const canvas = document.getElementById("signature-pad");
const ctx = canvas.getContext("2d");
const hiddenInput = document.getElementById("signature");
const resetBtn = document.getElementById("reset-btn");
const submitBtn = document.getElementById("submit-btn");

function resizeCanvas() {
    const style = getComputedStyle(canvas);
    canvas.width = parseInt(style.width);
    canvas.height = parseInt(style.height);
    ctx.lineWidth = 2;
    ctx.lineCap = "round";
    ctx.strokeStyle = "#000";
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

let drawing = false;
let lastX = 0, lastY = 0;

function getPointerPos(e) {
    const rect = canvas.getBoundingClientRect();
    if (e.touches) {
        return [e.touches[0].clientX - rect.left, e.touches[0].clientY - rect.top];
    } else {
        return [e.offsetX, e.offsetY];
    }
}

// Maus Events
canvas.addEventListener("mousedown", (e) => {
    drawing = true;
    [lastX, lastY] = getPointerPos(e);
});
canvas.addEventListener("mousemove", (e) => {
    if (!drawing) return;
    const [x, y] = getPointerPos(e);
    ctx.beginPath();
    ctx.moveTo(lastX, lastY);
    ctx.lineTo(x, y);
    ctx.stroke();
    [lastX, lastY] = [x, y];
});
canvas.addEventListener("mouseup", () => { drawing = false; saveSignature(); });
canvas.addEventListener("mouseout", () => { drawing = false; saveSignature(); });

// Touch Events
canvas.addEventListener("touchstart", (e) => { e.preventDefault(); drawing = true; [lastX, lastY] = getPointerPos(e); });
canvas.addEventListener("touchmove", (e) => {
    e.preventDefault();
    if (!drawing) return;
    const [x, y] = getPointerPos(e);
    ctx.beginPath();
    ctx.moveTo(lastX, lastY);
    ctx.lineTo(x, y);
    ctx.stroke();
    [lastX, lastY] = [x, y];
});
canvas.addEventListener("touchend", () => { drawing = false; saveSignature(); });

function saveSignature() {
    hiddenInput.value = canvas.toDataURL("image/png");
    checkForm();
}

// Reset Button
resetBtn.addEventListener("click", () => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    hiddenInput.value = "";
    checkForm();
});

// --- Button aktivieren/ deaktivieren ---
function checkForm() {
    const requiredFields = ["Vorname","Nachname","strasse","plz","ort","geburtsdatum","notfallnummer"];
    let allFilled = requiredFields.every(id => document.getElementById(id).value.trim() !== "");
    const dsgvoChecked = document.getElementById("dsgvo").checked;
    const sigFilled = hiddenInput.value.trim() !== "";

    if (allFilled && dsgvoChecked && sigFilled) {
        submitBtn.disabled = false;
        submitBtn.style.background = "#7ccc00";
    } else {
        submitBtn.disabled = true;
        submitBtn.style.background = "#aaa";
    }
}

// Überprüfen bei Input, Checkbox oder Reset
document.addEventListener("input", checkForm);
document.getElementById("dsgvo").addEventListener("change", checkForm);
resetBtn.addEventListener("click", checkForm);

</script>
</body>
</html>
