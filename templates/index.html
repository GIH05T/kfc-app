<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kinder-Ferien-Club Steinen – Online-Anmeldung</title>
<link rel="stylesheet" href="/static/style.css">
</head>
<body>
<div class="container">
    <img src="/static/icon-kfc.png" class="logo" alt="Ferienclub Logo">
    <h1>Kinder-Ferien-Club Steinen</h1>
    <h2>Online-Anmeldung</h2>

    <form id="registration-form" action="/" method="POST">
        <label for="Vorname">Vorname<span class="required">*</span></label>
        <input type="text" id="Vorname" name="Vorname" placeholder="Max" required>

        <label for="Nachname">Nachname<span class="required">*</span></label>
        <input type="text" id="Nachname" name="Nachname" placeholder="Mustermann" required>

        <label for="email">E-Mail</label>
        <input type="email" id="email" name="Email" placeholder="max@beispiel.de">

        <label for="strasse">Straße<span class="required">*</span></label>
        <input type="text" id="strasse" name="Strasse" placeholder="Musterstraße 12" required>

        <label for="plz">Postleitzahl<span class="required">*</span></label>
        <input type="text" id="plz" name="PLZ" placeholder="79665" required>

        <label for="ort">Ort<span class="required">*</span></label>
        <input type="text" id="ort" name="Ort" placeholder="Steinen" required>

        <label for="geburtsdatum">Geburtsdatum<span class="required">*</span></label>
        <input type="date" id="geburtsdatum" name="Geburtsdatum" required>

        <label for="notfallnummer">Notfalltelefonnummer<span class="required">*</span></label>
        <input type="tel" id="notfallnummer" name="Notfallnummer" placeholder="z.B. 01234 567890" required>

        <label for="allergien">Allergien</label>
        <select id="allergien" name="Allergien">
            <option value="">-- Bitte wählen --</option>
            <option value="keine">Keine</option>
            <option value="nüsse">Nüsse</option>
            <option value="laktose">Laktose</option>
            <option value="ei">Ei</option>
            <option value="gluten">Gluten</option>
        </select>

        <label>Unterschrift<span class="required">*</span></label>
        <canvas id="signature-pad"></canvas>
        <button type="button" class="reset-btn" id="reset-btn">Signatur löschen</button>
        <input type="hidden" id="signature" name="Unterschrift" required>

        <div class="checkbox-container">
            <input type="checkbox" id="dsgvo" name="DSGVO" required>
            <label for="dsgvo">Ich stimme der <a href="/datenschutz" target="_blank">Datenschutzerklärung</a> zu <span class="required">*</span></label>
        </div>

        <button type="submit">Jetzt anmelden</button>
    </form>
</div>

<script>
// --- Signatur Pad ---
const canvas = document.getElementById("signature-pad");
const ctx = canvas.getContext("2d");

// Canvas auf tatsächliche CSS-Größe skalieren
function resizeCanvas() {
    const style = getComputedStyle(canvas);
    canvas.width = parseInt(style.width);
    canvas.height = parseInt(style.height);
    ctx.lineWidth = 2;
    ctx.lineCap = "round";
    ctx.strokeStyle = "#000";
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

let drawing = false;
let lastX = 0;
let lastY = 0;

// Maus Events
canvas.addEventListener("mousedown", (e) => {
    drawing = true;
    [lastX, lastY] = [e.offsetX, e.offsetY];
});
canvas.addEventListener("mousemove", drawMouse);
canvas.addEventListener("mouseup", () => { drawing = false; saveSignature(); });
canvas.addEventListener("mouseout", () => { drawing = false; saveSignature(); });

function drawMouse(e) {
    if (!drawing) return;
    ctx.beginPath();
    ctx.moveTo(lastX, lastY);
    ctx.lineTo(e.offsetX, e.offsetY);
    ctx.stroke();
    [lastX, lastY] = [e.offsetX, e.offsetY];
}

// Touch Events
canvas.addEventListener("touchstart", (e) => {
    e.preventDefault();
    drawing = true;
    const rect = canvas.getBoundingClientRect();
    lastX = e.touches[0].clientX - rect.left;
    lastY = e.touches[0].clientY - rect.top;
});
canvas.addEventListener("touchmove", (e) => {
    e.preventDefault();
    if (!drawing) return;
    const rect = canvas.getBoundingClientRect();
    const x = e.touches[0].clientX - rect.left;
    const y = e.touches[0].clientY - rect.top;
    ctx.beginPath();
    ctx.moveTo(lastX, lastY);
    ctx.lineTo(x, y);
    ctx.stroke();
    [lastX, lastY] = [x, y];
});
canvas.addEventListener("touchend", () => { drawing = false; saveSignature(); });

function saveSignature() {
    document.getElementById("signature").value = canvas.toDataURL("image/png");
}

// Reset Button
document.getElementById("reset-btn").addEventListener("click", () => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    document.getElementById("signature").value = "";
});

const submitBtn = document.getElementById("submit-btn");

function checkForm() {
    const requiredFields = document.querySelectorAll(
        "#Vorname, #Nachname, #strasse, #plz, #ort, #geburtsdatum, #notfallnummer"
    );

    let allFilled = true;
    requiredFields.forEach(field => {
        if (!field.value.trim()) allFilled = false;
    });

    const dsgvo = document.getElementById("dsgvo").checked;
    const signatureFilled = document.getElementById("signature").value.trim() !== "";

    if (allFilled && dsgvo && signatureFilled) {
        submitBtn.disabled = false;
        submitBtn.style.background = "#7ccc00";  // ✅ gleiches Grün wie "Online Anmeldung"
    } else {
        submitBtn.disabled = true;
        submitBtn.style.background = "#aaa";     // grau
    }
}

// Auf ALLE Änderungen reagieren
document.addEventListener("input", checkForm);
document.getElementById("dsgvo").addEventListener("change", checkForm);
document.getElementById("reset-btn").addEventListener("click", checkForm);
</script>


</body>
</html>
